import{BigNumber as a,parseFixed as d}from"@ethersproject/bignumber";import{WeiPerEther as t}from"@ethersproject/constants";import{ONE_XP as u}from"../../gyroHelpers/constants.js";import{mulXpU as n,divXpU as r,divDownMagU as m,mulDownXpToNpU as o,mulDownMagU as l,mulUpMagU as c,sqrt as s,divUpMagU as b,mulUpXpToNpU as e,mulDown as f,divDown as y}from"../../gyroHelpers/gyroSignedFixedPoint.js";import{MAX_BALANCES as x}from"./constants.js";function i(a,d){const t=f(a,d);return a.sub(t)}function S(a,d){return y(a,t.sub(d))}function q(a,u){const n=u.map((a=>d("1",a)));return a.map(((a,d)=>a.mul(t).div(n[d])))}function p(a,d,t){return t?[a,d]:[d,a]}function g(a,d,t,u){const c=n(u.dSq,u.dSq),s=r(m(m(u.w,t.lambda).add(u.z),t.lambda),c);let b=o(l(a,t.c).sub(l(d,t.s)),s),e=l(l(a,t.lambda),t.s).add(l(l(d,t.lambda),t.c));return b=b.add(o(e,r(u.u,c))),e=l(a,t.s).add(l(d,t.c)),b=b.add(o(e,r(u.v,c))),b}function h(d,t,b,e){let f=function(a,d,t,s){let b=c(c(c(a,a),t.c),t.c).add(c(c(c(d,d),t.s),t.s));b=b.sub(l(l(l(a,d),t.c.mul(2)),t.s));const e=n(s.u,s.u).add(m(n(s.u.mul(2),s.v),t.lambda)).add(m(m(n(s.v,s.v),t.lambda),t.lambda));let f=o(b.mul(-1),e);return f=f.add(o(m(m(b.sub(9),t.lambda),t.lambda),r(u,s.dSq))),f}(d,t,b,e).add(function(a,d,t,u){let s=l(l(l(a,a).sub(c(d,d)),t.c.mul(2)),t.s);const b=l(d,a.mul(2));s=s.add(l(l(b,t.c),t.c)).sub(l(l(b,t.s),t.s));let e=n(u.z,u.u).add(m(m(n(u.w,u.v),t.lambda),t.lambda));e=e.add(m(n(u.w,u.u).add(n(u.z,u.v)),t.lambda)),e=r(e,n(n(n(u.dSq,u.dSq),u.dSq),u.dSq));const f=o(s,e);return f}(d,t,b,e));f=f.add(function(a,d,t,l){let s=c(c(c(a,a),t.s),t.s).add(c(c(c(d,d),t.c),t.c));s=s.add(c(c(c(a,d),t.s.mul(2)),t.c));let b=n(l.z,l.z).add(m(m(n(l.w,l.w),t.lambda),t.lambda));b=b.add(m(n(l.z.mul(2),l.w),t.lambda)),b=r(b,n(n(n(l.dSq,l.dSq),l.dSq),l.dSq));let e=o(s.mul(-1),b);return e=e.add(o(s.sub(9),r(u,l.dSq))),e}(d,t,b,e));const y=c(d,d).add(c(t,t)).div(u);return f=f.gt(0)?s(f,a.from(5)):a.from(0),[f,y]}function E(a,d){const t=n(n(d.dSq,d.dSq),d.dSq);let u=c(a.lambda,r(n(d.u.mul(2),d.v),t));u=u.add(c(c(r(n(d.u.add(1),d.u.add(1)),t),a.lambda),a.lambda)),u=u.add(r(n(d.v,d.v),t));const m=b(d.w,a.lambda).add(d.z);return u=u.add(r(n(m,m),t)),u}function v(d,t,u,n,m){if(0===m){const m=function(d,t,u){const n=r(t.tauBeta.x.sub(t.tauAlpha.x),t.dSq),m=r(t.tauBeta.y.sub(t.tauAlpha.y),t.dSq);let s=o(l(l(u.y,d.lambda),d.c),n);return s=s.add(m.gt(a.from(0))?l(u.y,d.s):o(c(u.x,d.s),m)),s}(d,t,u);if(n.gt(x)||n.gt(m))throw new Error("ASSET BOUNDS EXCEEDED")}else{const m=function(d,t,u){const n=r(t.tauBeta.x.sub(t.tauAlpha.x),t.dSq),m=r(t.tauBeta.y.sub(t.tauAlpha.y),t.dSq);let s=o(l(l(u.y,d.lambda),d.s),n);return s=s.add(m.gt(a.from(0))?l(u.y,d.c):o(c(u.x,d.c),m)),s}(d,t,u);if(n.gt(x)||n.gt(m))throw new Error("ASSET BOUNDS EXCEEDED")}}function w(a,d,t,u){const n={x:B(d,t,u),y:z(d,t,u)};return D(d.lambda,a,d.s,d.c,u,n,t.tauBeta,t.dSq)}function A(a,d,t,u){const n={x:z(d,t,u),y:B(d,t,u)};return D(d.lambda,a,d.c,d.s,u,n,{x:t.tauAlpha.x.mul(-1),y:t.tauAlpha.y},t.dSq)}function B(d,t,u,n){const m=n?t.tauAlpha:t.tauBeta,o=r(m.x,t.dSq);let s=m.x.gt(a.from(0))?e(c(c(u.x,d.lambda),d.c),o):e(l(l(u.y,d.lambda),d.c),o);return s=s.add(e(c(u.x,d.s),r(m.y,t.dSq))),s}function z(d,t,u,n){const m=n?t.tauBeta:t.tauAlpha,o=r(m.x,t.dSq);let s=m.x.lt(a.from(0))?e(c(c(u.x,d.lambda),d.s),o.mul(-1)):e(l(l(u.y.mul(-1),d.lambda),d.s),o);return s=s.add(e(c(u.x,d.c),r(m.y,t.dSq))),s}function D(d,t,n,f,y,x,i,S){const q={x:u.sub(m(m(u,d),d)),y:u.sub(b(b(u,d),d))},p={a:a.from(0),b:a.from(0),c:a.from(0)},g=t.sub(x.x);g.gt(a.from(0))?p.b=e(l(l(g.mul(-1),n),f),r(q.y,S)):p.b=e(c(c(g.mul(-1),n),f),r(q.x,S).add(1));const h={x:r(l(l(q.y,n),n),S),y:r(c(c(q.x,n),n),S.add(1)).add(1)};return h.x=u.sub(h.x),h.y=u.sub(h.y),p.c=j(t,y,d,n,f,i,S).mul(-1),p.c=p.c.add(o(l(y.y,y.y),h.y)),p.c=p.c.gt(a.from(0))?s(p.c,a.from(5)):a.from(0),p.b.sub(p.c).gt(a.from(0))?p.a=e(p.b.sub(p.c),r(u,h.y).add(1)):p.a=e(p.b.sub(p.c),r(u,h.x)),p.a.add(x.y)}function j(d,t,u,o,s,f,y){const x={x:n(y,y),y:c(t.x,t.x)},i={a:a.from(0),b:a.from(0),c:a.from(0)};let S=r(n(f.x,f.y),x.x);S.gt(a.from(0))?(i.a=c(x.y,o.mul(2)),i.a=e(c(i.a,s),S.add(7))):(i.a=l(l(t.y,t.y),o.mul(2)),i.a=e(l(i.a,s),S)),f.x.lt(a.from(0))?i.b=e(c(c(t.x,d),s.mul(2)),r(f.x,y).mul(-1).add(3)):i.b=e(l(l(t.y.mul(-1),d),s.mul(2)),r(f.x,y)),i.a=i.a.add(i.b),S=r(n(f.y,f.y),x.x).add(7),i.b=c(x.y,o),i.b=e(c(i.b,o),S),i.c=e(l(l(t.y.mul(-1),d),o.mul(2)),r(f.y,y)),i.b=i.b.add(i.c).add(c(d,d)),i.b=i.b.gt(a.from(0))?b(i.b,u):m(i.b,u),i.a=i.a.add(i.b),i.a=i.a.gt(a.from(0))?b(i.a,u):m(i.a,u),S=r(n(f.x,f.x),x.x).add(7);const q=c(c(x.y,s),s);return e(q,S).add(i.a)}export{S as addFee,p as balancesFromTokenInOut,E as calcAChiAChiInXp,g as calcAtAChi,h as calcInvariantSqrt,A as calcXGivenY,j as calcXpXpDivLambdaLambda,w as calcYGivenX,v as checkAssetBounds,q as normalizeBalances,i as reduceFee,B as virtualOffset0,z as virtualOffset1};
//# sourceMappingURL=gyroEMathHelpers.js.map
