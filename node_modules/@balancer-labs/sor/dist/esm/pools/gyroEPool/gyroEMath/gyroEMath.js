import{BigNumber as r}from"@ethersproject/bignumber";import{WeiPerEther as t}from"@ethersproject/constants";import{MAX_BALANCES as o,MAX_INVARIANT as n}from"./constants.js";import{ONE_XP as u,SMALL as e}from"../../gyroHelpers/constants.js";import{calcAtAChi as m,calcInvariantSqrt as s,calcAChiAChiInXp as E,checkAssetBounds as d,calcYGivenX as i,calcXGivenY as f}from"./gyroEMathHelpers.js";import{divUpMagU as c,sqrt as a,mulUpMagU as b,divXpU as l,mulDownXpToNpU as p,mulUpXpToNpU as D,divDown as N,mulDown as S}from"../../gyroHelpers/gyroSignedFixedPoint.js";import{normalizedLiquidityXIn as g,normalizedLiquidityYIn as w,dPxDYIn as h,dPyDXIn as A,dPxDXOut as j,dPyDYOut as X,calcSpotPriceYGivenX as y,calcSpotPriceXGivenY as C}from"./gyroEMathFunctions.js";function T(r,t,o,n,u,e){return e?g(r,t,o,u,n):w(r,t,o,u,n)}function M(t,e,d){const[i,f]=t;if(i.add(f).gt(o))throw new Error("MAX ASSETS EXCEEDED");const N=m(i,f,e,d),S=s(i,f,e,d),g=S[0];let w=S[1];w=g.gt(0)?c(w.add(1),g.mul(2)):w.gt(0)?a(w,r.from(5)):r.from(10).pow(9),w=b(e.lambda,i.add(f)).div(u).add(w).add(1).mul(20);const h=l(u,E(e,d).sub(u)),A=p(N.add(g).sub(w),h);if(w=D(w,h),w=w.add(D(A,h).mul(e.lambda.mul(e.lambda).div(r.from(10).pow(36))).mul(40).div(u)).add(1),A.add(w).gt(n))throw new Error("MAX INVARIANT EXCEEDED");return[A,w]}function v(t,o,n,u,m,s){if(o.lt(e))return r.from(0);const E=Number(!n),c=Number(n),a=n?i:f,b=t[E].add(o);d(u,m,s,b,E);const l=a(b,u,m,s),p=t[c].sub(l);if(p.lt(0))throw new Error("ASSET BOUNDS EXCEEDED 1");return p}function B(t,o,n,u,m,s){if(o.lt(e))return r.from(0);const E=Number(!n),c=Number(n),a=n?f:i;if(o.gt(t[c]))throw new Error("ASSET BOUNDS EXCEEDED 2");const b=a(t[c].sub(o),u,m,s);d(u,m,s,b,E);const l=b.sub(t[E]);if(l.lt(0))throw new Error("ASSET BOUNDS EXCEEDED 3");return l}function H(r,o,n,u,e,m,s){const E=Number(!n),d=t.sub(s),i=(n?y:C)(r[E].add(o),u,e,m);return N(t,S(i,d))}function O(r,o,n,u,e,m,s){const E=Number(n),d=t.sub(s),i=(n?C:y)(r[E].sub(o),u,e,m);return N(i,d)}function U(r,t,o,n,u,e){return Number(!t)?h(r,o,n,e,u):A(r,o,n,e,u)}function x(r,t,o,n,u,e){return Number(!t)?j(r,o,n,e,u):X(r,o,n,e,u)}export{U as calcDerivativePriceAfterSwapOutGivenIn,x as calcDerivativeSpotPriceAfterSwapInGivenOut,B as calcInGivenOut,v as calcOutGivenIn,O as calcSpotPriceAfterSwapInGivenOut,H as calcSpotPriceAfterSwapOutGivenIn,M as calculateInvariantWithError,T as calculateNormalizedLiquidity};
//# sourceMappingURL=gyroEMath.js.map
