import{formatFixed as t}from"@ethersproject/bignumber";import{WeiPerEther as e}from"@ethersproject/constants";import{bnum as i,ONE as n,ZERO as s}from"../../utils/bignumber.js";const l=i(1e3);function u(e,n){let l=s;const u=n.length;for(let t=0;t<u;t++)l=l.plus(n[t]);if(l.isZero())return s;let m=s,o=l;const r=i(t(e,3)).times(u**u);for(let t=0;t<255;t++){let t=i(u).times(n[0]);for(let e=1;e<u;e++)t=t.times(n[e]).times(u).div(o);if(m=o,o=i(u).times(o).times(o).plus(r.times(l).times(t)).div(i(u+1).times(o).plus(r.minus(1).times(t))),o.gt(m)){if(o.minus(m).lt(i(1e-18)))break}else if(m.minus(o).lt(i(1e-18)))break}return o}function m(t,l){if(t.isZero())return t;const{amp:m,allBalances:o,tokenIndexIn:r,tokenIndexOut:a,swapFee:d}=l,c=[...o],v=c.length,f=m.div(v**(v-1));let g=t;g=g.times(e.sub(d).toString()).div(e.toString());const I=u(f,c);let h=I,B=s;const S=i(c.length);let k=n,x=s;for(let t=0;t<c.length;t++){if(k=k.times(S),t==r)x=c[t].plus(g);else{if(t==a)continue;x=c[t]}B=B.plus(x),h=h.times(I).div(x)}const w=p(B,I,f,k,h);return c[a].minus(w)}function o(t,l){if(t.isZero())return t;const{amp:m,allBalances:o,tokenIndexIn:r,tokenIndexOut:a,swapFee:d}=l,c=[...o],v=c.length,f=m.div(v**(v-1)),g=t,I=u(f,c);let h=I,B=s;const S=i(c.length);let k=n,x=s;for(let t=0;t<c.length;t++){if(k=k.times(S),t==a)x=c[t].minus(g);else{if(t==r)continue;x=c[t]}B=B.plus(x),h=h.times(I).div(x)}return p(B,I,f,k,h).minus(c[r]).multipliedBy(e.toString()).div(e.sub(d).toString())}function r(e,n){if(e.isZero())return e;const{amp:s,allBalances:l,virtualBptSupply:m,decimalsOut:o,tokenIndexIn:r,swapFee:a}=n,p=[...l],c=p.length,v=s.div(c**(c-1)),f=e,g=u(v,p),I=i(t(m,o)),h=I.plus(f).div(I).times(g);let B=i(0);for(let t=0;t<p.length;t++)B=B.plus(p[t]);const S=d(v,p,h,r).minus(p[r]),k=p[r].div(B),x=i(1).minus(k),w=i(t(a,18));return S.div(i(1).minus(x.times(w)))}function a(e,n){if(e.isZero())return e;const{amp:s,allBalances:l,virtualBptSupply:m,decimalsIn:o,tokenIndexOut:r,swapFee:a}=n,d=[...l],p=d.length,c=s.div(p**(p-1)),v=e,f=u(c,d);let g=i(0);for(let t=0;t<d.length;t++)g=g.plus(d[t]);const I=d[r].div(g),h=d[r].minus(v).div(d[r]),B=i(1).minus(i(1).minus(h).times(I)).minus(h).div(i(1).minus(h)),S=i(t(a,18)),k=v.div(i(1).minus(S.times(B)));d[r]=d[r].minus(k);const x=u(c,d);return i(t(m,o)).times(i(1).minus(x.div(f)))}function d(t,e,i,l){let u=i,m=s;const o=e.length;let r=n,a=s;for(let t=0;t<o;t++)r=r.times(o),t!=l&&(a=e[t],m=m.plus(a),u=u.times(i).div(a));return p(m,i,t,r,u)}function p(e,n,s,l,u){const m=i(t(s,3));u=u.times(n).div(m.times(l).times(l));const o=e.plus(n.div(m.times(l)));let r;return r=n.gte(o)?n.minus(o).plus(n.minus(o).times(n.minus(o)).plus(u.times(4)).sqrt()):o.minus(n).times(o.minus(n)).plus(u.times(4)).sqrt().minus(o.minus(n)),r.div(2)}function c(e,n){if(e.isZero())return e;const{amp:s,allBalances:l,virtualBptSupply:m,tokenIndexIn:o,swapFee:r,decimalsOut:a}=n,d=[...l],p=d.length,c=s.div(p**(p-1)),v=e,f=u(c,d);let g=i(0);for(let t=0;t<d.length;t++)g=g.plus(d[t]);const I=d[o].div(g),h=d[o].plus(v).div(d[o]),B=i(1).plus(h.minus(i(1)).times(I)),S=h.minus(B).div(h.minus(i(1))),k=i(t(r,18)),x=v.times(i(1).minus(k.times(S)));d[o]=d[o].plus(x);const w=u(c,d);return i(t(m,a)).times(w.div(f).minus(i(1)))}function v(s,l){if(s.isZero())return s;const{amp:m,allBalances:o,tokenIndexOut:r,swapFee:a}=l,p=[...o],c=p.length,v=m.div(c**(c-1)),f=s,g=u(v,p),I=i(t(l.virtualBptSupply,18)),h=I.minus(f).div(I).times(g);let B=i(0);for(let t=0;t<p.length;t++)B=B.plus(p[t]);const S=d(v,p,h,r),k=p[r].minus(S),x=p[r].div(B),w=i(1).minus(x);return k.times(n.minus(w.times(a.toString()).div(e.toString())))}function f(e,n,l,m,o,r){const a=n.length,d=u(e,n);let p=s;for(let t=0;t<a;t++)t!=l&&t!=m&&(p=p.plus(n[t]));const c=n[l],v=n[m],f=i(t(e,3)).times(a**a),g=p.minus(d).times(f).plus(d),I=i(2).times(f).times(c).times(v),h=I.plus(f.times(v).times(v)).plus(g.times(v)),B=I.plus(f.times(c).times(c)).plus(g.times(c));let S;if(o)S=h.div(B);else{const t=i(2).times(f).times(v),e=i(2).times(f).times(c),n=t.plus(e).plus(g),s=i(2).times(h).times(B).times(n).minus(t.times(B.pow(2))).minus(e.times(h.pow(2))),l=h.pow(2).times(B);S=s.div(l),r&&(S=S.times(B).div(h))}return S}function g(t,e,n,m,o,r,a){const d=e.length,p=u(t,e);let c=s,v=p.div(d);for(let t=0;t<d;t++)t!=m&&(c=c.plus(e[t]),v=v.times(p).div(e[t].times(d)));const f=e[m],g=i(t.toString()).times(d**d),I=g.times(c),h=l.minus(g),B=i(2).times(g).times(f).plus(I).plus(h.times(p)),S=v.times(d+1).times(l).minus(h.times(f)),k=s.minus(S);let x;if(o)x=B.div(S).times(n).div(p);else{const t=i(2).times(g),e=h,l=d*(d+1),u=s.minus(v.times(l).div(p));if(r){const l=t.times(k).div(B.pow(2)),m=i(2).times(e).div(B),o=u.div(k);if(x=l.minus(m).plus(o).times(p).div(n),a){const t=s.minus(B.div(k));x=x.div(t).times(p).div(n)}}else x=i(2).times(e).div(k).minus(u.times(B).div(k.pow(2))).minus(t.div(B)),a&&(x=x.times(B).div(S).times(n).div(p))}return x}function I(t,i){const{amp:s,allBalances:l,tokenIndexIn:u,tokenIndexOut:o,swapFee:r}=i,a=[...l],d=a.length,p=s.div(d**(d-1));a[u]=a[u].plus(t.times(e.sub(r).toString()).div(e.toString())),a[o]=a[o].minus(m(t,i));let c=f(p,a,u,o,!0,!1);return c=n.div(c.times(e.sub(r).toString()).div(e.toString())),c}function h(t,i){const{amp:s,allBalances:l,tokenIndexIn:u,tokenIndexOut:m,swapFee:r}=i,a=[...l],d=a.length,p=s.div(d**(d-1)),c=o(t,i).times(e.sub(r).toString()).div(e.toString());a[u]=a[u].plus(c),a[m]=a[m].minus(t);let v=f(p,a,u,m,!0,!0);return v=n.div(v.times(e.sub(r).toString()).div(e.toString())),v}function B(t,i,l){let u=s;for(let e=0;e<t.length;e++)u=u.plus(t[e]);const m=t[i].div(u),o=n.minus(m);return n.minus(o.times(l.toString()).div(e.toString()))}function S(e,n){const{amp:s,allBalances:l,virtualBptSupply:u,decimalsOut:m,tokenIndexIn:o,swapFee:r}=n,a=[...l],d=a.length,p=s.div(d**(d-1)),v=B(a,o,r);let f=i(t(u,m));a[o]=a[o].plus(e.times(v)),f=f.plus(c(e,n));let I=g(p,a,f,o,!0,!0,!1);return I=i(1).div(I.times(v)),I}function k(e,s){const{amp:l,allBalances:u,virtualBptSupply:m,tokenIndexIn:o,decimalsOut:a,swapFee:d}=s,p=[...u],c=p.length,v=l.div(c**(c-1)),f=r(e,s),I=B(p,o,d);p[o]=p[o].plus(f.times(I));let h=i(t(m,a));h=h.plus(e);let S=g(v,p,h,o,!0,!0,!0);return S=n.div(S.times(I)),S}function x(e,n){const{amp:s,allBalances:l,virtualBptSupply:u,tokenIndexOut:m,swapFee:o,decimalsIn:r}=n,a=[...l],d=a.length,p=s.div(d**(d-1)),c=v(e,n),f=B(a,m,o);let I=i(t(u,r));a[m]=a[m].minus(c.div(f)),I=I.minus(e);return g(p,a,I,m,!0,!1,!1).div(f)}function w(e,n){const{amp:s,allBalances:l,virtualBptSupply:u,decimalsIn:m,tokenIndexOut:o,swapFee:r}=n,d=[...l],p=d.length,c=s.div(p**(p-1)),v=B(d,o,r);d[o]=d[o].minus(e.div(v));let f=i(t(u,m));f=f.minus(a(e,n));return g(c,d,f,o,!0,!1,!0).div(v)}function O(t,i){const{amp:n,allBalances:s,tokenIndexIn:l,tokenIndexOut:u,swapFee:o}=i,r=[...s],a=r.length,d=n.div(a**(a-1));return r[l]=r[l].plus(t.times(e.sub(o).toString()).div(e.toString())),r[u]=r[u].minus(m(t,i)),f(d,r,l,u,!1,!1)}function F(e,n){const{amp:s,allBalances:l,tokenIndexIn:u,tokenIndexOut:m,swapFee:r}=n,a=[...l],d=a.length,p=s.div(d**(d-1)),c=i(t(r,18)),v=o(e,n).times(i(1).minus(c));a[u]=a[u].plus(v),a[m]=a[m].minus(e);const g=i(1).minus(c);return f(p,a,u,m,!1,!0).div(g)}function b(e,n){const{amp:s,allBalances:l,balanceOut:u,decimalsOut:m,tokenIndexIn:o,swapFee:r}=n,a=[...l],d=a.length,p=s.div(d**(d-1)),v=B(a,o,r);a[o]=a[o].plus(e.times(v));let f=i(t(u,m));f=f.plus(c(e,n));return g(p,a,f,o,!1,!0,!1)}function y(e,n){const{amp:s,allBalances:l,balanceOut:u,decimalsOut:m,tokenIndexIn:o,swapFee:a}=n,d=[...l],p=d.length,c=s.div(p**(p-1)),v=r(e,n),f=B(d,o,a);d[o]=d[o].plus(v.times(f));let I=i(t(u,m));return I=I.plus(e),g(c,d,I,o,!1,!0,!0).div(f)}function Z(e,n){const{amp:s,allBalances:l,balanceIn:u,decimalsIn:m,tokenIndexOut:o,swapFee:r}=n,d=[...l],p=d.length,c=s.div(p**(p-1)),v=a(e,n),f=B(d,o,r);d[o]=d[o].minus(e.div(f));let I=i(t(u,m));I=I.minus(v);return g(c,d,I,o,!1,!1,!0).div(f.pow(2))}function j(e,n){const{amp:s,allBalances:l,balanceIn:u,decimalsIn:m,tokenIndexOut:o,swapFee:r}=n,a=[...l],d=a.length,p=s.div(d**(d-1)),c=v(e,n),f=B(a,o,r);a[o]=a[o].minus(c.div(f));let I=i(t(u,m));I=I.minus(e);return g(p,a,I,o,!1,!1,!1).div(f)}export{a as _BPTInForExactTokenOut,Z as _derivativeSpotPriceAfterSwapBPTInForExactTokenOut,j as _derivativeSpotPriceAfterSwapExactBPTInForTokenOut,b as _derivativeSpotPriceAfterSwapExactTokenInForBPTOut,O as _derivativeSpotPriceAfterSwapExactTokenInForTokenOut,y as _derivativeSpotPriceAfterSwapTokenInForExactBPTOut,F as _derivativeSpotPriceAfterSwapTokenInForExactTokenOut,v as _exactBPTInForTokenOut,c as _exactTokenInForBPTOut,m as _exactTokenInForTokenOut,u as _invariant,f as _poolDerivatives,g as _poolDerivativesBPT,p as _solveAnalyticalBalance,w as _spotPriceAfterSwapBPTInForExactTokenOut,x as _spotPriceAfterSwapExactBPTInForTokenOut,S as _spotPriceAfterSwapExactTokenInForBPTOut,I as _spotPriceAfterSwapExactTokenInForTokenOut,k as _spotPriceAfterSwapTokenInForExactBPTOut,h as _spotPriceAfterSwapTokenInForExactTokenOut,r as _tokenInForExactBPTOut,o as _tokenInForExactTokenOut};
//# sourceMappingURL=phantomStableMath.js.map
