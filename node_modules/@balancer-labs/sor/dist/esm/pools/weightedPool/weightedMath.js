import{formatFixed as e}from"@ethersproject/bignumber";import{bnum as t}from"../../utils/bignumber.js";import{MathSol as n,BZERO as a}from"../../utils/basicOperations.js";const o=BigInt("3000000000000000000");function i(e,t,a,o,i,l){i=function(e,t){const a=n.mulUpFixed(e,t);return e-a}(i,l);const r=n.divDownFixed(t,o),u=n.add(e,i),d=n.divUpFixed(e,u),F=n.powUpFixed(d,r);return n.mulDownFixed(a,n.complementFixed(F))}function l(e,t,a,o,i,l){const r=n.divUpFixed(a,a-i),u=n.divUpFixed(o,t),d=n.powUpFixed(r,u),F=n.sub(d,n.ONE);return function(e,t){return n.divUpFixed(e,n.complementFixed(t))}(n.mulUpFixed(e,F),l)}function r(e,t,a,o,i,l){const r=n.mulUpFixed(e,o);let u=n.mulUpFixed(a,t);const d=n.complementFixed(l);u=n.mulUpFixed(u,d);const F=n.divUpFixed(e,n.add(n.mulUpFixed(i,d),e)),s=n.divUpFixed(t+o,o);return u=n.mulUpFixed(u,n.powUpFixed(F,s)),n.divUpFixed(r,u)}function u(e,t,a,o,i,l){let r=n.mulUpFixed(e,o);const u=n.complementFixed(l),d=n.divUpFixed(a,n.sub(a,i)),F=n.divUpFixed(t+o,t);r=n.mulUpFixed(r,n.powUpFixed(d,F));const s=n.mulUpFixed(n.mulUpFixed(a,t),u);return n.divUpFixed(r,s)}function d(e,t,o,i,l){const r=new Array(o.length);let u=a;for(let a=0;a<e.length;a++)r[a]=n.divDownFixed(n.add(e[a],o[a]),e[a]),u=n.add(u,n.mulDownFixed(r[a],t[a]));let d=n.ONE;for(let a=0;a<e.length;a++){let i;if(r[a]>u){const t=n.mulDownFixed(e[a],n.sub(u,n.ONE)),r=n.sub(o[a],t),d=n.mulUpFixed(r,l);i=n.add(t,n.sub(r,d))}else i=o[a];const F=n.divDownFixed(n.add(e[a],i),e[a]);d=n.mulDownFixed(d,n.powDown(F,t[a]))}return d>n.ONE?n.mulDownFixed(i,n.sub(d,n.ONE)):a}function F(e,t,a){const o=n.divDownFixed(t,a),i=new Array(e.length);for(let t=0;t<e.length;t++)i[t]=n.mulDownFixed(e[t],o);return i}function s(e,t,a,o,i){const l=n.divUpFixed(n.sub(o,a),o),r=n.powUpFixed(l,n.divDownFixed(n.ONE,t)),u=n.mulDownFixed(e,n.complementFixed(r)),d=n.mulUpFixed(u,n.complementFixed(t)),F=n.sub(u,d),s=n.mulUpFixed(d,i);return n.add(F,n.sub(d,s))}function p(e,t,o,i,l){const r=new Array(o.length);let u=a;for(let a=0;a<e.length;a++)r[a]=n.divUpFixed(n.sub(e[a],o[a]),e[a]),u=n.add(u,n.mulUpFixed(r[a],t[a]));const d=function(e,t,a,o,i,l){let r=n.ONE;for(let u=0;u<e.length;u++){let d;if(i>o[u]){const t=n.mulDownFixed(e[u],n.complementFixed(i)),o=n.sub(a[u],t),r=n.divUpFixed(o,n.complementFixed(l));d=n.add(t,r)}else d=a[u];const F=n.divDownFixed(n.sub(e[u],d),e[u]);r=n.mulDownFixed(r,n.powDown(F,t[u]))}return r}(e,t,o,r,u,l);return n.mulUpFixed(i,n.complementFixed(d))}const c=(e,t,a,i,l)=>{const r=n.divUpFixed(n.add(i,a),i);if(r>o)throw new Error("MAX_OUT_BPT_FOR_TOKEN_IN");const u=n.powUpFixed(r,n.divUpFixed(n.ONE,t)),d=n.mulUpFixed(e,n.sub(u,n.ONE)),F=n.complementFixed(t),s=n.mulUpFixed(d,F),p=n.sub(d,s);return n.add(p,n.divUpFixed(s,n.complementFixed(l)))};function m(e,t){let a=n.ONE;for(let o=0;o<e.length;o++)a=n.mulDownFixed(a,n.powDown(t[o],e[o]));if(a<0)throw Error("Weighted Invariant < 0");return a}function x(e,t,o,i){const l=n.divDownFixed(o,t);if(l<=n.ONE)return a;const r=n.divDownFixed(n.mulDownFixed(i,l-n.ONE),l),u=n.mulDownFixed(e,r),d=n.complementFixed(r);return d==a?a:n.divDownFixed(u,d)}function w(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightIn,18)),r=parseFloat(e(a.weightOut,18)),u=n.toNumber(),d=parseFloat(e(a.swapFee,18));return t(-o*r/(i*(-1+d)*(o/(u+o-u*d))**((l+r)/r)*l))}function b(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightIn,18)),r=parseFloat(e(a.weightOut,18)),u=n.toNumber(),d=parseFloat(e(a.swapFee,18));return t(-o*(i/(-u+i))**((l+r)/l)*r/(i*(-1+d)*l))}function O(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightIn,18)),r=n.toNumber(),u=parseFloat(e(a.swapFee,18));return t(o*((r+o+r*u*(-1+l))/o)**(1-l)/(i*(1+u*(-1+l))*l))}function U(e,t,a,o,i){const l=n.ONE-n.mulDownFixed(n.complementFixed(a),i),r=n.powDown(n.ONE+o*l/e,n.complementFixed(a));return n.divDownFixed(n.ONE,t*a*l/(e*r))}function f(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightOut,18)),r=n.toNumber(),u=parseFloat(e(a.swapFee));return t((1-r/o)**((-1+l)/l)*o*(1+u*(-1+l))*l/i)}function I(n,a){const o=parseFloat(e(a.balanceIn,18)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightOut,18)),r=n.toNumber(),u=parseFloat(e(a.swapFee,18));return t(o*(1+u*(-1+l))*l*(1+r*(-1+u-u*l)/i)**(-1+l)/i)}function N(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,18)),l=parseFloat(e(a.weightIn,18)),r=n.toNumber(),u=parseFloat(e(a.swapFee,18));return t(((r+i)/i)**(1/l)*o/((r+i)*(1+u*(-1+l))*l))}function g(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightIn,18)),r=parseFloat(e(a.weightOut,18)),u=n.toNumber(),d=parseFloat(e(a.swapFee,18));return t((l+r)/(i*(o/(u+o-u*d))**(l/r)*l))}function h(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightIn,18)),r=parseFloat(e(a.weightOut,18)),u=n.toNumber(),d=parseFloat(e(a.swapFee,18));return t(-o*(i/(-u+i))**(r/l)*r*(l+r)/((u-i)**2*(-1+d)*l**2))}function v(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut,18)),l=parseFloat(e(a.weightIn,18)),r=n.toNumber(),u=parseFloat(e(a.swapFee,18));return t(-(-1+l)/(i*((r+o+r*u*(-1+l))/o)**l*l))}function D(n,a){const o=parseFloat(e(a.balanceIn,a.decimalsIn)),i=parseFloat(e(a.balanceOut.toNumber(),18)),l=parseFloat(e(a.weightIn,18)),r=n.toNumber(),u=parseFloat(e(a.swapFee,18));return t(-(((r+i)/i)**(1/l))*o*(-1+l)/((r+i)**2*(1+u*(-1+l))*l**2))}function E(n,a){const o=parseFloat(e(a.balanceIn,18)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightOut,18)),r=n.toNumber(),u=parseFloat(e(a.swapFee,18));return t(-(1+u*(-1+l))*(-1+l)/((1-r/o)**(1/l)*i))}function _(n,a){const o=parseFloat(e(a.balanceIn,18)),i=parseFloat(e(a.balanceOut,a.decimalsOut)),l=parseFloat(e(a.weightOut)),r=n.toNumber(),u=parseFloat(e(a.swapFee));return t(-o*(1+u*(-1+l))**2*(-1+l)*l*(1+r*(-1+u-u*l)/i)**(-2+l)/i**2)}export{p as _calcBptInGivenExactTokensOut,d as _calcBptOutGivenExactTokensIn,x as _calcDueProtocolSwapFeeBptAmount,l as _calcInGivenOut,i as _calcOutGivenIn,c as _calcTokenInGivenExactBptOut,s as _calcTokenOutGivenExactBptIn,F as _calcTokensOutGivenExactBptIn,m as _calculateInvariant,_ as _derivativeSpotPriceAfterSwapBPTInForExactTokenOut,E as _derivativeSpotPriceAfterSwapExactBPTInForTokenOut,v as _derivativeSpotPriceAfterSwapExactTokenInForBPTOut,g as _derivativeSpotPriceAfterSwapExactTokenInForTokenOut,D as _derivativeSpotPriceAfterSwapTokenInForExactBPTOut,h as _derivativeSpotPriceAfterSwapTokenInForExactTokenOut,I as _spotPriceAfterSwapBPTInForExactTokenOut,U as _spotPriceAfterSwapBptOutGivenExactTokenInBigInt,f as _spotPriceAfterSwapExactBPTInForTokenOut,O as _spotPriceAfterSwapExactTokenInForBPTOut,w as _spotPriceAfterSwapExactTokenInForTokenOut,r as _spotPriceAfterSwapExactTokenInForTokenOutBigInt,N as _spotPriceAfterSwapTokenInForExactBPTOut,b as _spotPriceAfterSwapTokenInForExactTokenOut,u as _spotPriceAfterSwapTokenInForExactTokenOutBigInt};
//# sourceMappingURL=weightedMath.js.map
