import{__awaiter as t}from"./external/tslib/tslib.es6.js";import{AddressZero as n,WeiPerEther as e}from"@ethersproject/constants";import{Lido as o,getStEthRate as r}from"./pools/lido/index.js";import{SwapTypes as s}from"./types.js";import{TokensToUnbuttonWrapperMap as a,getWrapperRate as u}from"./wrappers/unbutton.js";import{isSameAddress as i}from"./utils/index.js";var p;function d(i,d,w,m,l,c){return t(this,void 0,void 0,(function*(){w=w.toLowerCase(),m=m.toLowerCase();let t=c,T=w,k=p.None,E=m,I=p.None,O=e,A=e;if(w===n&&(T=l.weth.toLowerCase(),k=p.ETH),m===n&&(E=l.weth.toLowerCase(),I=p.ETH),w===o.stETH[l.chainId]){T=o.wstETH[l.chainId],k=p.stETH;const n=yield r(i,l.chainId);O=n,d===s.SwapExactIn&&(t=c.mul(n).div(e))}if(m===o.stETH[l.chainId]){E=o.wstETH[l.chainId],I=p.stETH;const n=yield r(i,l.chainId);A=n,d===s.SwapExactOut&&(t=c.mul(n).div(e))}const S=a[l.chainId]||{};return S[w]&&(T=S[w],k=p.Unbutton,O=yield u(i,T),d===s.SwapExactIn&&(t=c.mul(O).div(e))),S[m]&&(E=S[m],I=p.Unbutton,A=yield u(i,E),d===s.SwapExactOut&&(t=c.mul(A).div(e))),{swapAmountOriginal:c,swapAmountForSwaps:t,tokenIn:{addressOriginal:w,addressForSwaps:T,wrapType:k,rate:O},tokenOut:{addressOriginal:m,addressForSwaps:E,wrapType:I,rate:A}}}))}function w(t,o,r,a){if(0===t.swaps.length)return t;if(t.tokenIn=r.tokenIn.addressOriginal,t.tokenOut=r.tokenOut.addressOriginal,t.swapAmountForSwaps=t.swapAmount,t.returnAmountFromSwaps=t.returnAmount,t.tokenInForSwaps=r.tokenIn.addressForSwaps,t.tokenOutFromSwaps=r.tokenOut.addressForSwaps,r.tokenIn.wrapType===p.None&&r.tokenOut.wrapType===p.None)return t;r.tokenIn.wrapType!==p.ETH&&r.tokenOut.wrapType!==p.ETH||(t.tokenAddresses=t.tokenAddresses.map((t=>i(t,a.weth)?n:t)));const u=t=>t===p.stETH||t===p.Unbutton;return(u(r.tokenIn.wrapType)&&o===s.SwapExactIn||u(r.tokenOut.wrapType)&&o===s.SwapExactOut)&&(t.swapAmount=r.swapAmountOriginal,t.swapAmountForSwaps=r.swapAmountForSwaps),o===s.SwapExactIn&&u(r.tokenOut.wrapType)&&(t.returnAmount=t.returnAmount.mul(e).div(r.tokenOut.rate),t.returnAmountConsideringFees=t.returnAmountConsideringFees.mul(e).div(r.tokenOut.rate)),o===s.SwapExactOut&&u(r.tokenIn.wrapType)&&(t.returnAmount=t.returnAmount.mul(e).div(r.tokenIn.rate),t.returnAmountConsideringFees=t.returnAmountConsideringFees.mul(e).div(r.tokenIn.rate)),t}!function(t){t[t.None=0]="None",t[t.ETH=1]="ETH",t[t.stETH=2]="stETH",t[t.Unbutton=3]="Unbutton"}(p||(p={}));export{p as WrapTypes,d as getWrappedInfo,w as setWrappedInfo};
//# sourceMappingURL=wrapInfo.js.map
